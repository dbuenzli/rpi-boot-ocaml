opam-version: "2.0"
maintainer: "daniel.buenzl i@erratique.ch"
authors: "The OCaml development team"
homepage: "http://ocaml.org"
bug-reports: "https://github.com/ocaml/opam-repository/issues"
dev-repo: "git+https://github.com/ocaml/ocaml.git"
license: "LGPL-2.1-or-later WITH OCaml-LGPL-linking-exception"
substs: ["armv7-none-eabihf.conf" "config/Makefile"]

build: [[ make "bare" ]]

install: [
 [ make "bare-install" ]

 # Copy base OCaml system META files
 [ "cp" "-r" "%{prefix}%/lib/bigarray" "%{prefix}%/armv7-none-eabihf/lib" ]
 [ "cp" "-r" "%{prefix}%/lib/bytes" "%{prefix}%/armv7-none-eabihf/lib" ]
 [ "cp" "-r" "%{prefix}%/lib/compiler-libs" "%{prefix}%/armv7-none-eabihf/lib" ]
 [ "cp" "-r" "%{prefix}%/lib/compiler-libs" "%{prefix}%/armv7-none-eabihf/lib" ]
 [ "cp" "-r" "%{prefix}%/lib/findlib" "%{prefix}%/armv7-none-eabihf/lib" ]
 [ "cp" "-r" "%{prefix}%/lib/num" "%{prefix}%/armv7-none-eabihf/lib" ]
 [ "cp" "-r" "%{prefix}%/lib/num-top" "%{prefix}%/armv7-none-eabihf/lib" ]
 [ "cp" "-r" "%{prefix}%/lib/stdlib" "%{prefix}%/armv7-none-eabihf/lib" ]
 [ "cp" "-r" "%{prefix}%/lib/str" "%{prefix}%/armv7-none-eabihf/lib" ]
 [ # For unix.cmi needed by bigarrays the unix library itself is not available.
   "cp" "-r" "%{prefix}%/lib/unix" "%{prefix}%/armv7-none-eabihf/lib" ]
 [ # We don't heave threads but otherwise ocamlfind complains
   "cp" "-r" "%{prefix}%/lib/threads" "%{prefix}%/armv7-none-eabihf/lib" ]

 [ "mkdir" "-p" "%{prefix}%/lib/findlib.conf.d" ]
 [ "cp" "armv7-none-eabihf.conf" "%{prefix}%/lib/findlib.conf.d/" ]
]

remove: [
  [ "rm" "-f" "%{prefix}%/armv7-none-eabihf/bin/ocaml" ]
  [ "rm" "-f" "%{prefix}%/armv7-none-eabihf/bin/ocamlc" ]
  [ "rm" "-f" "%{prefix}%/armv7-none-eabihf/bin/ocamlcp" ]
  [ "rm" "-f" "%{prefix}%/armv7-none-eabihf/bin/ocamldep" ]
  [ "rm" "-f" "%{prefix}%/armv7-none-eabihf/bin/ocamllex" ]
  [ "rm" "-f" "%{prefix}%/armv7-none-eabihf/bin/ocamlmklib" ]
  [ "rm" "-f" "%{prefix}%/armv7-none-eabihf/bin/ocamlmktop" ]
  [ "rm" "-f" "%{prefix}%/armv7-none-eabihf/bin/ocamlopt" ]
  [ "rm" "-f" "%{prefix}%/armv7-none-eabihf/bin/ocamloptp" ]
  [ "rm" "-f" "%{prefix}%/armv7-none-eabihf/bin/ocamlprof" ]
  [ "rm" "-f" "%{prefix}%/armv7-none-eabihf/bin/ocamlrun" ]
  [ "rm" "-f" "%{prefix}%/armv7-none-eabihf/bin/ocamlrund" ]
  [ "rm" "-f" "%{prefix}%/armv7-none-eabihf/bin/ocamlyacc" ]
  [ "rm" "-rf" "%{prefix}%/armv7-none-eabihf/lib/ocaml" ]
  [ "rm" "-f" "%{prefix}%/lib/findlib.conf.d/armv7-none-eabihf.conf" ]
]

depends: [ "ocaml" {= "4.02.3"} "ocaml-variants" {= "4.02.3+32bit"} "ocamlfind" {>= "1.5.4"} ]

depexts: [
  ["gcc-arm-none-eabi"] {os-distribution = "debian"}
  ["gcc-arm-none-eabi"] {os-distribution = "ubuntu"}
  ["armmbed/formulae/arm-none-eabi-gcc"]
  {os = "macos" & os-distribution = "homebrew"}
]

available: arch = "x86_32"
synopsis: "OCaml cross-compiler for bare 32-bit armv7 with hard float"
description: "You will need to provide your own libc."
flags: light-uninstall
extra-files: [
  ["armv7-none-eabihf.conf.in" "md5=6047e37c327dfba75e6e477d320a397e"]
  ["bare-include/dirent.h" "md5=b74610472bb2dfecb2ef8bb32f348b7c"]
  ["bare-include/sys/ucontext.h" "md5=3d9ae92600c9d0835043a380a927ae63"]
  ["config/s.h" "md5=948414d3fc50fedd5dc3efa08e56c39b"]
  ["config/m.h" "md5=85c754520e42cc7daefa470c66e057cc"]
  ["config/Makefile.in" "md5=ad4a3552357d7db3829c2d83e1230c4c"]
  ["config/.ignore" "md5=32c2851983acb5ab6bc1a2fe42357e8c"]
]
url {
  src: "http://caml.inria.fr/pub/distrib/ocaml-4.02/ocaml-4.02.3.tar.gz"
  checksum: "md5=ef1a324608c97031cbd92a442d685ab7"
}
